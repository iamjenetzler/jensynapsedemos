{
	"name": "Create Views",
	"properties": {
		"content": {
			"query": " \ncreate DATABASE SCOPED CREDENTIAL WorkspaceIdentity1\nWITH IDENTITY='SHARED ACCESS SIGNATURE'\n, SECRET = 'sv=2020-08-04&ss=bfqt&srt=c&sp=rwdlacupx&se=2022-04-21T05:33:26Z&st=2022-04-20T21:33:26Z&spr=https&sig=iXabxh9KgHxOIqqbi9o5huD7vXtUmfChDhTp8t2ZnAE%3D';\n\nGO\nGRANT REFERENCES ON DATABASE SCOPED CREDENTIAL::WorkspaceIdentity1 TO [kalyany@microsoft.com] \n \nCREATE EXTERNAL DATA SOURCE enriched WITH (\n    \tLOCATION   = 'https://synapsehackstor.dfs.core.windows.net/enriched', \n    CREDENTIAL = WorkspaceIdentity1\n);\n\n\n--EXECUTE AS USER= 'jen@microsoft.com'\n\nalter VIEW catalog_sales\nas\n  \nSELECT cs_sold_date_sk, cs_sold_time_sk, cs_ship_date_sk, cs_bill_customer_sk, cs_bill_cdemo_sk, cs_bill_hdemo_sk, cs_bill_addr_sk, cs_ship_customer_sk, cs_ship_cdemo_sk, cs_ship_hdemo_sk, cs_ship_addr_sk, cs_call_center_sk, cs_catalog_page_sk, cs_ship_mode_sk, cs_warehouse_sk, cs_item_sk, cs_promo_sk, cs_order_number, cs_quantity, cs_wholesale_cost, cs_list_price, cs_sales_price, cs_ext_discount_amt, cs_ext_sales_price, cs_ext_wholesale_cost, cs_ext_list_price, cs_ext_tax, cs_coupon_amt, cs_ext_ship_cost, cs_net_paid, cs_net_paid_inc_tax, cs_net_paid_inc_ship, cs_net_paid_inc_ship_tax, cs_net_profit\n,cast(rows.filepath(2) as int) as [d_year]\n,cast(rows.filepath(3) as int) as d_qoy\n,cast(rows.filepath(4) as int) as d_moy\nFROM OPENROWSET( BULK '/*/catalog_sales/d_year=*/d_qoy=*/d_moy=*/*.parquet',\n                                DATA_SOURCE = 'enriched',\n                                FORMAT='parquet'\n                )  as rows \nwhere rows.filepath(1) = (select max(x.filepath(1)) latest_data from  OPENROWSET( BULK '/*/catalog_sales/d_year=*/d_qoy=*/d_moy=*/*.parquet',\n                                DATA_SOURCE = 'enriched',\n                                FORMAT='parquet'\n                )\n                with\n                (\n                    latest_data DATETIME\n                ) x\n)\n \nGO\nalter VIEW customer\nas \nSELECT   * \nFROM OPENROWSET( BULK '/*/customer/*.parquet',\n                                DATA_SOURCE = 'enriched',\n                                FORMAT='parquet'\n                ) \n                WITH\n                (    c_customer_sk             integer               ,\n    c_customer_id             char(16)             ,\n    c_current_cdemo_sk        integer                       ,\n    c_current_hdemo_sk        integer                       ,\n    c_current_addr_sk         integer                       ,\n    c_first_shipto_date_sk    integer                       ,\n    c_first_sales_date_sk     integer                       ,\n    c_salutation              char(10)                      ,\n    c_first_name              char(20)                      ,\n    c_last_name               char(30)                      ,\n    c_preferred_cust_flag     char(1)                       ,\n    c_birth_day               integer                       ,\n    c_birth_month             integer                       ,\n    c_birth_year              integer                       ,\n    c_birth_country           varchar(20)                   ,\n    c_login                   char(13)                      ,\n    c_email_address           char(50)                      ,\n    c_last_review_date        char(10)         \n\n                )as rows \nwhere rows.filepath(1) = (select max(x.filepath(1)) latest_data from  OPENROWSET( BULK '/*/customer/*.parquet',\n                                DATA_SOURCE = 'enriched',\n                                FORMAT='parquet'\n                )\n                with\n                (\n                    latest_data DATETIME\n                ) x\n)\n\ngo \nalter VIEW customer_address\nas \nSELECT   * \nFROM OPENROWSET( BULK '/*/customer_address/*.parquet',\n                                DATA_SOURCE = 'enriched',\n                                FORMAT='parquet'\n                ) \n                WITH\n                (       \n    ca_address_sk             integer               ,\n    ca_address_id             char(16)             ,\n    ca_street_number          char(10)                      ,\n    ca_street_name            varchar(60)                   ,\n    ca_street_type            char(15)                      ,\n    ca_suite_number           char(10)                      ,\n    ca_city                   varchar(60)                   ,\n    ca_county                 varchar(30)                   ,\n    ca_state                  char(2)                       ,\n    ca_zip                    char(10)                      ,\n    ca_country                varchar(20)                   ,\n    ca_gmt_offset             decimal(5,2)                  ,\n    ca_location_type          char(20)                      \n   \n\n                )as rows     \nwhere rows.filepath(1) = (select max(x.filepath(1)) latest_data from  OPENROWSET( BULK '/*/customer_address/*.parquet',\n                                DATA_SOURCE = 'enriched',\n                                FORMAT='parquet'\n                )\n                with\n                (\n                    latest_data DATETIME\n                ) x\n)\n\n\ngo\nalter VIEW catalog_returns\nas \nSELECT   * \nFROM OPENROWSET( BULK '/*/catalog_returns/*.parquet',\n                                DATA_SOURCE = 'enriched',\n                                FORMAT='parquet'\n                ) \n                WITH\n                (    cr_returned_date_sk       integer                       ,\n    cr_returned_time_sk       integer                       ,\n    cr_item_sk                integer               ,\n    cr_refunded_customer_sk   integer                       ,\n    cr_refunded_cdemo_sk      integer                       ,\n    cr_refunded_hdemo_sk      integer                       ,\n    cr_refunded_addr_sk       integer                       ,\n    cr_returning_customer_sk  integer                       ,\n    cr_returning_cdemo_sk     integer                       ,\n    cr_returning_hdemo_sk     integer                       ,\n    cr_returning_addr_sk      integer                       ,\n    cr_call_center_sk         integer                       ,\n    cr_catalog_page_sk        integer                       ,\n    cr_ship_mode_sk           integer                       ,\n    cr_warehouse_sk           integer                       ,\n    cr_reason_sk              integer                       ,\n    cr_order_number           bigint              ,\n    cr_return_quantity        integer                       ,\n    cr_return_amount          decimal(7,2)                  ,\n    cr_return_tax             decimal(7,2)                  ,\n    cr_return_amt_inc_tax     decimal(7,2)                  ,\n    cr_fee                    decimal(7,2)                  ,\n    cr_return_ship_cost       decimal(7,2)                  ,\n    cr_refunded_cash          decimal(7,2)                  ,\n    cr_reversed_charge        decimal(7,2)                  ,\n    cr_store_credit           decimal(7,2)                  ,\n    cr_net_loss               decimal(7,2)                 \n)as rows \nwhere rows.filepath(1) = (select max(x.filepath(1)) latest_data from  OPENROWSET( BULK '/*/catalog_returns/*.parquet',\n                                DATA_SOURCE = 'enriched',\n                                FORMAT='parquet'\n                )\n                with\n                (\n                    latest_data DATETIME\n                ) x\n)\n\ngo\nalter VIEW date_dim\nas \nSELECT   * \nFROM OPENROWSET( BULK '/*/date_dim/*.parquet',\n                                DATA_SOURCE = 'enriched',\n                                FORMAT='parquet'\n                ) \n                WITH\n                (    d_date_sk                 integer                ,\n    d_date_id                 char(16)               ,\n    d_date                    date                          ,\n    d_month_seq               integer                       ,\n    d_week_seq                integer                       ,\n    d_quarter_seq             integer                       ,\n    d_year                    integer                       ,\n    d_dow                     integer                       ,\n    d_moy                     integer                       ,\n    d_dom                     integer                       ,\n    d_qoy                     integer                       ,\n    d_fy_year                 integer                       ,\n    d_fy_quarter_seq          integer                       ,\n    d_fy_week_seq             integer                       ,\n    d_day_name                char(9)                       ,\n    d_quarter_name            char(6)                       ,\n    d_holiday                 char(1)                       ,\n    d_weekend                 char(1)                       ,\n    d_following_holiday       char(1)                       ,\n    d_first_dom               integer                       ,\n    d_last_dom                integer                       ,\n    d_same_day_ly             integer                       ,\n    d_same_day_lq             integer                       ,\n    d_current_day             char(1)                       ,\n    d_current_week            char(1)                       ,\n    d_current_month           char(1)                       ,\n    d_current_quarter         char(1)                       ,\n    d_current_year            char(1)                       \n    \n)as rows \nwhere rows.filepath(1) = (select max(x.filepath(1)) latest_data from  OPENROWSET( BULK '/*/date_dim/*.parquet',\n                                DATA_SOURCE = 'enriched',\n                                FORMAT='parquet'\n                )\n                with\n                (\n                    latest_data DATETIME\n                ) x\n)\n\nGO\nalter VIEW call_center\nas \nSELECT   * \nFROM OPENROWSET( BULK '/*/call_center/*.parquet',\n                                DATA_SOURCE = 'enriched',\n                                FORMAT='parquet'\n                ) \n                WITH\n                (       cc_call_center_sk         integer                ,\n    cc_call_center_id         char(16)               ,\n    cc_rec_start_date         date                          ,\n    cc_rec_end_date           date                          ,\n    cc_closed_date_sk         integer                       ,\n    cc_open_date_sk           integer                       ,\n    cc_name                   varchar(50)                   ,\n    cc_class                  varchar(50)                   ,\n    cc_employees              integer                       ,\n    cc_sq_ft                  integer                       ,\n    cc_hours                  char(20)                      ,\n    cc_manager                varchar(40)                   ,\n    cc_mkt_id                 integer                       ,\n    cc_mkt_class              char(50)                      ,\n    cc_mkt_desc               varchar(100)                  ,\n    cc_market_manager         varchar(40)                   ,\n    cc_division               integer                       ,\n    cc_division_name          varchar(50)                   ,\n    cc_company                integer                       ,\n    cc_company_name           char(50)                      ,\n    cc_street_number          char(10)                      ,\n    cc_street_name            varchar(60)                   ,\n    cc_street_type            char(15)                      ,\n    cc_suite_number           char(10)                      ,\n    cc_city                   varchar(60)                   ,\n    cc_county                 varchar(30)                   ,\n    cc_state                  char(2)                       ,\n    cc_zip                    char(10)                      ,\n    cc_country                varchar(20)                   ,\n    cc_gmt_offset             decimal(5,2)                  ,\n    cc_tax_percentage         decimal(5,2)                  \n) as rows\nwhere rows.filepath(1) = (select max(x.filepath(1)) latest_data from  OPENROWSET( BULK '/*/call_center/*.parquet',\n                                DATA_SOURCE = 'enriched',\n                                FORMAT='parquet'\n                )\n                with\n                (\n                    latest_data DATETIME\n                ) x\n)",
			"metadata": {
				"language": "sql"
			},
			"currentConnection": {
				"databaseName": "lakehouse",
				"poolName": "Built-in"
			},
			"resultLimit": 5000
		},
		"type": "SqlQuery"
	}
}